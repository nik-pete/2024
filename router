#############################################
# доменное имя
####Linux:
hostnamectl set-hostname ИМЯ.ДОМЕН

#####EcoRouter:
enable
configure terminal
hostname ИМЯ
ip domain-name ДОМЕН


###vESR:
configure
hostname ИМЯ
domain name ДОМЕН




###########################################################
#Ecorouter
#Uplink
r#conf t
r(config)#interface Uplink					    	            	Создаем интерфейс с именем ISP (имя произвольное)
r(config-if)#ip address 172.200.40.102/28
r(config-if)#no shutdown
r(config-if)#exit

r(config)#port ge0									                  	Заходим в режим настройки порта
r(config-port)#service-instance Internet			  	    	Создаем сервисный интерфейс с именем Internet (имя произвольное) 
r(config-port)#encapsulation untagged				         	Указываем что трафик не тегированный
r(config-service-instance)#connect ip interface uplink		Указание в какой интерфейс нужно отправить обработанные кадры.r-dt(config-service-instance)#
r(config-service-instance)#exit
r(config-service-instance)#exit

r-dt(config)#ip route 0.0.0.0/0 172.200.40.101


#downlink
r(config)#interface v11						                     Создаем интерфейс с именем v110 (имя произвольное)
r(config-if)#ip address 192.168.3.1/26
r(config-if)#no shutdown
r(config-if)#exit
r(config)#interface v33
r(config-if)#ip address 192.168.3.65/29
r(config-if)#no shutdown
r(config-if)#exit


r(config)#port ge1
r(config-port)#service-instance ge1/vlan110             			Создаем сабинтерфейс с именем ge1/vlan110 (имя произвольное) 
r(config-service-instance)#encapsulation dot1q 110 exact			Указываем номер обрабатываемого VLAN
r(config-service-instance)#rewrite pop 1							         Снимаем метку VLAN, чтобы передать кадр на L3 интерфейс
r(config-service-instance)#connect ip interface v110			  	Указание в какой интерфейс нужно отправить обработанные кадры.
r(config-service-instance)#exit
r(config-port)#service-instance ge1/vlan330
r(config-service-instance)#encapsulation dot1q 330 exact
r(config-service-instance)#rewrite pop 1
r(config-service-instance)#connect ip interface v330
r(config-service-instance)#exit
r(config-port)#exit


#Настройка динамической трансляции адресов
r(config)#interface v110
r(config-if)#ip nat inside					                            Помечаем интерфейс как внутренний
r(config-if)#exit
r(config)#interface v330
r(config-if)#ip nat inside
r(config-if)#exit

r(config)#interface ISP			
r(config-if)#ip nat outside				                          	Помечаем интерфейс как внешний
r(config-if)#exit

r-dt(config)#ip nat pool NAT 192.168.33.1-192.168.33.254  					          Создаем пул адресов с именем NAT
r-dt(config)#ip nat source dynamic inside pool NAT overload 172.16.4.14		    Создаем динамические трансляции много-в-один для пакетов из внутренней сети, source IP которых будет попадать в диапазон адресов, определяемый пулом.

r-dt(config)#exit
r-dt#write





#########################################################################
#ESR
r-br#show interface status
#Uplink
r-br#configure
r-br(config)#interface gi1/0/1
r-br(config-if-gi)#ip address dhcp
r-br(config-if-gi)#ip firewall disable
r-br(config-if-gi)#no shutdown
r-br(config-if-gi)#exit
r-br(config)#interface gi1/0/2
r-br(config-if-gi)#no shutdown
r-br(config-if-gi)#exit

r-br(config)#interface gi1/0/2.330
r-br(config-if-gi)#ip address 192.168.22.1/29
r-br(config-if-gi)#ip firewall disable
r-br(config-if-gi)#exit

#Настройка динамической трансляции адресов

r-br(config)#object-group network LAN							              Создаем профиль адресов локальной сети с именем LAN
r-br(config-object-group-network)#ip prefix 192.168.22.0/24			Указываем префикс сети которой разрешен выход в публичную сеть
r-br(config-object-group-network)#exit
r-br(config)#nat source											                   	Конфигурируем сервис SNAT
r-br(config-snat)#ruleset MASQUERADE								            Создаем набор правил c именем MASQUERADE
r-br(config-snat-ruleset)#to interface gi1/0/1					      	Указываем, что правила применяются только для пакетов направляющихся в публичную сеть через внешний интерфейс 
r-br(config-snat-ruleset)#rule 10									              Создаем правило 10
r-br(config-snat-rule)#match source-address LAN					      	Правила включают проверку адреса источника данных на принадлежность к пулу LAN.
r-br(config-snat-rule)#action source-nat interface				    	Адреса, попадающие под правило, меняют адрес на адрес внешнего интерфейса
r-br(config-snat-rule)#enable										                Включаем правило
r-br(config-snat-rule)#exit
r-br(config-snat-rule)#exit
r-br(config-snat-rule)#exit
r-br(config)#exit
r-br#commit
r-br#confirm
r-br#save



#########################################################################################
############tunnel
#Ecorouter
r-dt(config)#interface tunnel.<НОМЕР>										                  	Создание интерфейса туннеля, где номер произвольное число, например, для R-DT interface tunnel.1
r-dt(config-if-tunnel)#ip add <IP АДРЕС ТУННЕЛЯ>								            Назначение ip адреса, например, для R-DT ip add 10.10.10.1/30
r-dt(config-if-tunnel)#ip mtu <ЗНАЧЕНИЕ>									                	Задание значения mtu для интерфейса, например, для R-DT  ip mtu 1400
r-dt(config-if-tunnel)#ip tunnel <source IP> <destination IP> mode gre			Задание IP-адресов начала и конца туннеля и типа туннеля, например, для R-DT ip tunnel 172.16.4.14 172.16.6.2 mode gre
r-dt(config-if-tunnel)#exit
r-dt(config)#

#ESR
r-br(config)#tunnel gre <НОМЕР>								                  	Создаём интерфейс gre, где номер произвольное число, например, для R-BR tunnel gre 1
r-br(config-gre)#ip add <IP АДРЕС ТУННЕЛЯ>					            	Назначение ip адреса, например, для R-BR ip add 10.10.10.2/30
r-br(config-gre)#local interface <ИМЯ ВНЕШНЕГО ИНТЕРФЕЙСА>        Указываем имя внешнего интерфейса, например, для R-BR local interface gi1/0/1
r-br(config-gre)#remote address <ВНЕШНИЙ АДРЕС СОСЕДА>			      Указываем внешний адрес противоположенной стороны, например, для R-BR remote address 172.16.4.14
r-br(config-gre)#mtu <ЗНАЧЕНИЕ>									                  Задание значения mtu для интерфейса, например, для R-BR mtu 1400
r-br(config-gre)#ttl <ЗНАЧЕНИЕ>									                  Задание значения TTL для интерфейса, например, для R-BR ttl 64
r-br(config-gre)#ip firewall disable
r-br(config-gre)#enable
r-br(config-gre)#exit
r-dt#show tunnel status



##########OSPF
#Ecorouter
r-dt(config)#router ospf 1
r-dt(config-router)#network 10.10.10.0/30 area 0.0.0.0
r-dt(config-router)#network 10.10.11.0/30 area 0.0.0.0
r-dt(config-router)#network 192.168.33.0/26 area 0.0.0.0
r-dt(config-router)#network 192.168.33.64/29 area 0.0.0.0
r-dt(config-router)#passive-interface default
r-dt(config-router)#no passive-interface tunnel.1
r-dt(config-router)#no passive-interface tunnel.2
r-dt(config-router)#exit
r-dt(config)#

#ESR
r-br(config)#router ospf 1
r-br(config-ospf)#area 0.0.0.0
r-br(config-ospf-area)#network 10.10.10.0/30
r-br(config-ospf-area)#network 10.10.12.0/30
r-br(config-ospf-area)#network 192.168.22.0/29
r-br(config-ospf-area)#enable
r-br(config-ospf-area)#exit
r-br(config-ospf)#enable
r-br(config-ospf)#exit
r-br(config)#
r-br(config-gre)#tunnel gre 1
r-br(config-gre)#ip ospf instance 1
r-br(config-gre)#ip ospf
r-br(config-gre)#exit
r-br(config)#
r-br(config)#do commit
r-br(config)#do confirm


#####Настройка OSPF между R-DT и R-BR(парольная защита)
#Ecorouter
r-dt(config)#interface tunnel.1
r-dt(config-if-tunnel)#ip ospf authentication
r-dt(config-if-tunnel)#ip ospf authentication-key P@ssw0rd 
r-dt(config-if-tunnel)#exit
r-dt(config)#

#ESR
r-br(config-gre)#tunnel gre 1
r-br(config-gre)#ip ospf authentication key ascii-text P@ssw0rd 
r-br(config-gre)#ip ospf authentication algorithm cleartext
tr-br(config-gre)#exit
r-br(config)#
r-br(config)#do commit
r-br(config)#do confirm


###############################################################################
###########Настройка протокола динамической конфигурации хостов
#Настройка DHCP-Server на EcoRouter
r-br(config)#ip pool <ИМЯ ПУЛА> <НАЧАЛЬНЫЙ АДРЕС> - <КОНЕЧНЫЙ АДРЕС>		Задаём POOL адресов с именем <ИМЯ ПУЛА> и задаём диапазон адресов, который будет раздаваться DHCP сервером
r-br(config)#dhcp-server <НОМЕР>										                  	Входим в режим конфигурации DHCP сервера, где <НОМЕР> – номер сервера в системе маршрутизатора
r-br(config-dhcp-server)#pool <ИМЯ ПУЛА> <НОМЕР> 						          	Привязываем ранее созданный POOL раздаваемых адресов с именем <ИМЯ ПУЛА> с указанием номера сервера в системе маршрутизатора <НОМЕР>
r-br(config-dhcp-server-pool)#gateway <АДРЕС ШЛЮЗА>						        	gateway <АДРЕС ШЛЮЗА>
r-br(config-dhcp-server-pool)#domain-name <ДОМЕННОЕ ИМЯ>				      	Определяем параметра DHCP 15 (доменное имя)
r-br(config-dhcp-server-pool)#dns <АДРЕС DNS СЕРВЕРА>						        Определяем параметра DHCP 6 (список DNS-серверов)
r-br(config-dhcp-server-pool)#exit
r-br(config-dhcp-server)#exit
r-br(config)#
r-br(config)#interface <ИМЯ ИНТЕРФЕЙСА>										               Указываем, на каком интерфейсе маршрутизатор будет принимать пакеты DHCP Discover и отвечать на них предложением с IP-настройками
r-br(config-if)#dhcp-server <НОМЕР>
r-br(config-if)#exit
r-br(config)#


#Настройка DHCP-Server на vESR
r-br(config)#ip dhcp-server pool <ИМЯ ПУЛА>										                  Создадим пул адресов с именем <ИМЯ ПУЛА>
r-br(config-dhcp-server)#network <IP АДРЕС СЕТИ>							                	Указываем адрес сети, из которой выдавать адреса
r-br(config-dhcp-server)#address-range <НАЧАЛЬНЫЙ АДРЕС> - <КОНЕЧНЫЙ АДРЕС>		  Определяем диапазон адресов, разрешенных для распределения
r-br(config-dhcp-server)#excluded-address-range <АДРЕС> - <АДРЕС>			        	Определяем диапазон адресов, не разрешенных для распределения (команду можно повторять сколько угодно раз, для исключения нужных адресов или диапазонов)
r-br(config-dhcp-server)#default-router <АДРЕС ШЛЮЗА>						              	Определяем параметра DHCP 3 (список маршрутизаторов по умолчанию)
r-br(config-dhcp-server)#domain-name "<ДОМЕННОЕ ИМЯ>"						               	Определяем параметра DHCP 15 (доменное имя)		
r-br(config-dhcp-server)#dns-server <АДРЕС DNS 1>, <АДРЕС DNS 2>			        	Определяем параметра DHCP 6 (список DNS-серверов)
r-br(config-dhcp-server)#exit

r-br(config)#ip dhcp-server														Включаем DHCP-сервер







































